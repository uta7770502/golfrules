<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>3ã‚¿ãƒƒãƒ—ãƒ«ãƒ¼ãƒ«ã‚º</title>
  <link rel="stylesheet" href="style.css" />
  <style>
    body{background:#f9fff9;font-family:"Helvetica",sans-serif;margin:0;padding-bottom:90px}
    header{background:#00bfa5;color:#fff;text-align:center;padding:16px 0;font-size:24px;font-weight:bold;border-bottom-left-radius:25px;border-bottom-right-radius:25px}
    .title{font-size:26px;font-weight:800;color:#0f8a62;margin:12px 16px 0}
    .sec{border-radius:18px;margin:14px 16px;padding:16px 16px;border:1px solid #e6e6e6;box-shadow:0 4px 10px rgba(0,0,0,.06)}
    .sec.how{background:#e8fff3;border-left:8px solid #11a371}
    .sec.pen{background:#ffe9e9;border-left:8px solid #e65757}
    .sec h2{margin:0 0 10px;font-size:20px;color:#0a8a63}
    .sec.pen h2{color:#c31313}
    .sec p{margin:8px 0 0;font-size:17px;line-height:1.8;color:#222}
    .penalty-red{color:#e60000;font-weight:800}
    .penalty-green{color:#009900;font-weight:800}
    .bottom-nav{position:fixed;left:0;bottom:0;width:100%;height:70px;background:#fff;border-top:1px solid #ddd;display:flex;justify-content:space-around;align-items:center;box-shadow:0 -2px 8px rgba(0,0,0,.05);z-index:1000}
    .bottom-nav a{display:flex;align-items:center;justify-content:center;text-decoration:none;height:100%;width:33.33%}
    .bottom-nav img{width:50px;height:auto;display:block}
    .back-btn{display:block;width:220px;margin:16px auto 6px;background:#FFD84D;color:#00997f;font-weight:800;text-align:center;border-radius:40px;padding:12px 16px;text-decoration:none;box-shadow:0 6px 14px rgba(0,0,0,.12)}
  </style>
</head>
<body>
  <header>3ã‚¿ãƒƒãƒ—ãƒ«ãƒ¼ãƒ«ã‚º</header>

  <h1 id="ruleTitle" class="title"></h1>

  <section class="sec how">
    <h2>å‡¦ç½®æ–¹æ³•</h2>
    <div id="howBody"></div>
  </section>

  <section class="sec pen">
    <h2>ãƒšãƒŠãƒ«ãƒ†ã‚£</h2>
    <div id="penBody"></div>
  </section>

  <a id="backBtn" class="back-btn" href="rules.html">ãƒ«ãƒ¼ãƒ«è©³ç´°ã¸æˆ»ã‚‹</a>

  <nav class="bottom-nav">
    <a href="index.html"><img src="home-icon.png" alt="ãƒ›ãƒ¼ãƒ "></a>
    <a href="rules.html"><img src="book-icon.png" alt="ãƒ«ãƒ¼ãƒ«ä¸€è¦§"></a>
    <a href="favorites.html"><img src="star-icon.png" alt="ãŠæ°—ã«å…¥ã‚Š"></a>
  </nav>

  <script>
    // ğŸ”´ èµ¤ãƒ»ç·‘ã®ãƒã‚¤ãƒ©ã‚¤ãƒˆé–¢æ•°
    function highlightPenalty(text){
      if(!text) return "";
      return text
        .replace(/([0-9]+æ‰“ç½°|ä¸€æ‰“ç½°|äºŒæ‰“ç½°|ä¸‰æ‰“ç½°|â—‹æ‰“ç½°)/g, "<span class='penalty-red'>$1</span>")
        .replace(/(ç„¡ç½°|0æ‰“ç½°)/g, "<span class='penalty-green'>$1</span>");
    }
  // ğŸ§  è‡ªå‹•è£œå®Œé–¢æ•°ï¼šãƒ«ãƒ¼ãƒ«ã‹ã‚‰å‡¦ç½®ã¨ãƒšãƒŠãƒ«ãƒ†ã‚£ã‚’æ¨å®š
  function inferHowPenalty(rule){
    const bag = [
      rule.penalty, rule.penalties, rule.mistakePenalty,
      rule.procedure, rule.how, rule.correct, rule.correctProcedure,
      rule.description, rule.detail, rule.note, rule.title, rule.category
    ].filter(Boolean).join(" ");
    const has = (...k)=>k.some(word=>bag.includes(word));

    if (has("ãƒ­ã‚¹ãƒˆ","è¦‹ã¤ã‹ã‚‰","OB","ç™½æ­","ç´›å¤±"))
      return { how:"å‰ã®æ‰“çƒåœ°ç‚¹ã¸æˆ»ã£ã¦æ‰“ã¡ç›´ã—ï¼ˆã‚¹ãƒˆãƒ­ãƒ¼ã‚¯ï¼†ãƒ‡ã‚£ã‚¹ã‚¿ãƒ³ã‚¹ï¼‰ã€‚", pen:"1æ‰“ç½°ã€‚" };
    if (has("èµ¤æ­","é»„è‰²æ­","ãƒšãƒŠãƒ«ãƒ†ã‚£ã‚¨ãƒªã‚¢","æ± ","ãƒã‚¶ãƒ¼ãƒ‰"))
      return { how:"æœ€å¾Œã«æ¨ªåˆ‡ã£ãŸç‚¹ã‚’åŸºæº–ã«ãƒ‰ãƒ­ãƒƒãƒ—ã€‚", pen:"1æ‰“ç½°ã€‚" };
    if (has("ã‚¢ãƒ³ãƒ—ãƒ¬ãƒ¤ãƒ–ãƒ«"))
      return { how:"å…ƒã®ä½ç½®ãƒ»å¾Œæ–¹ç·šä¸Šãƒ»1ã‚¯ãƒ©ãƒ–ä»¥å†…ã®ã„ãšã‚Œã‹ã«ãƒ‰ãƒ­ãƒƒãƒ—ã€‚", pen:"1æ‰“ç½°ã€‚" };
    if (has("èª¤çƒ"))
      return { how:"èª¤çƒã®æ‰“æ•°ã¯ç„¡åŠ¹ã€‚è‡ªçƒã‹ã‚‰æ‰“ã¡ç›´ã™ã€‚", pen:"2æ‰“ç½°ã€‚" };
    if (has("èª¤æ‰€","ãƒ†ã‚£ãƒ¼ã‚¤ãƒ³ã‚°ã‚¨ãƒªã‚¢å¤–"))
      return { how:"æ­£ã—ã„ä½ç½®ã«æˆ»ã£ã¦æ‰“ã¡ç›´ã™ã€‚", pen:"2æ‰“ç½°ã€‚" };
    if (has("ç„¡ç½°","æ•‘æ¸ˆ"))
      return { how:"å®Œå…¨æ•‘æ¸ˆç‚¹ã‚’æ±ºã‚ã¦ãƒ‰ãƒ­ãƒƒãƒ—ã€‚", pen:"ç„¡ç½°ã€‚" };
    return { how:"", pen:"" };
  }
    // ğŸ”§ ãƒ¡ã‚¤ãƒ³å‡¦ç†
    (async () => {
      const params = new URLSearchParams(location.search);
      const id = params.get("id");

      const titleEl = document.getElementById("ruleTitle");
      const howEl   = document.getElementById("howBody");
      const penEl   = document.getElementById("penBody");
      const backBtn = document.getElementById("backBtn");

      try {
        const res = await fetch("https://uta7770502.github.io/rules.json?v=" + Date.now(), { cache: "no-store" });
        if (!res.ok) throw new Error("fetch failed");

        const rules = await res.json();
        const rule = rules.find(r => String(r.id) === String(id));
        if (!rule) throw new Error("not found");

        titleEl.textContent = rule.title || "ãƒ«ãƒ¼ãƒ«";

        // âœ… ã™ã¹ã¦ã®å¯èƒ½æ€§ã‚ã‚‹ã‚­ãƒ¼ã‚’åŒ…æ‹¬
        const how =
          rule.procedure ||
          rule.correct ||
          rule.correctMethod ||
          rule.correctAction ||
          rule.how ||
          rule.howto ||
          rule.detail ||
          rule.action ||
          "å‡¦ç½®æ–¹æ³•ã®æƒ…å ±ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚";

        const pen =
          rule.mistakePenalty ||
          rule.penalty ||
          rule.penalties ||
          rule.penaltyText ||
          rule.sanction ||
          rule.punishment ||
          "ç‰¹ã«ç½°ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚";

        // âœ… æ®µè½ã«åˆ†å‰²ï¼‹è£…é£¾
        howEl.innerHTML = highlightPenalty(how).split(/\n+/).map(p=>`<p>${p}</p>`).join("");
        penEl.innerHTML = highlightPenalty(pen).split(/\n+/).map(p=>`<p>${p}</p>`).join("");

        // âœ… æˆ»ã‚‹ãƒœã‚¿ãƒ³
        backBtn.addEventListener('click', (e) => {
          e.preventDefault();
          if (document.referrer) history.back();
          else location.href = 'rules.html';
        });

      } catch (e) {
        titleEl.textContent = "å†…å®¹ã‚’èª­ã¿è¾¼ã‚ã¾ã›ã‚“ã§ã—ãŸ";
        howEl.innerHTML = "<p>å‡¦ç½®æ–¹æ³•ã®æƒ…å ±ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚</p>";
        penEl.innerHTML = "<p>ãƒšãƒŠãƒ«ãƒ†ã‚£ã®æƒ…å ±ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚</p>";
        console.error("âŒ rule_detail load error:", e);
      }
    })();
  </script>
</body>
</html>
