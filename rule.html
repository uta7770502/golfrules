<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>3ã‚¿ãƒƒãƒ—ãƒ«ãƒ¼ãƒ«ã‚º | ãƒ«ãƒ¼ãƒ«è©³ç´°</title>
  <link rel="stylesheet" href="style.css?v=6"/>
  <style>
    body{background:#f9fff9;margin:0;font-family:"Hiragino Sans",sans-serif}
    header{background:#c9f5c9;color:#044;text-align:center;font-weight:700;padding:12px 8px}
    .wrap{max-width:760px;margin:10px auto;padding:0 12px}
    .card{background:#fff;border:1px solid #d9f7d9;border-radius:12px;box-shadow:0 2px 6px rgba(0,0,0,.06);padding:16px}
    .title{color:#064;font-size:18px;font-weight:700;margin:0 0 6px}
    .cat{font-size:12px;color:#666;margin:0 0 12px}
    .desc{font-size:14px;margin:0 0 10px}
    .detail{font-size:14px;line-height:1.7}
    .btns{display:flex;gap:10px;justify-content:center;margin:18px 0}
    .btn{background:#66bb6a;color:#fff;text-decoration:none;padding:10px 16px;border-radius:8px}
  </style>
</head>
<body>
  <header>3ã‚¿ãƒƒãƒ—ãƒ«ãƒ¼ãƒ«ã‚º</header>

  <div class="wrap">
    <div class="card">
      <h1 class="title" id="t">èª­ã¿è¾¼ã¿ä¸­â€¦</h1>
      <p class="cat" id="c"></p>
      <p class="desc" id="d"></p>
      <div class="detail" id="x"></div>
      <button id="favoriteButton">â­ ãŠæ°—ã«å…¥ã‚Šã«è¿½åŠ </button>
      <script>
document.addEventListener("DOMContentLoaded", async () => {
  const params = new URLSearchParams(window.location.search);
  const id = Number(params.get("id"));
  const res = await fetch("rules.json");
  const rules = await res.json();
  const rule = rules.find(r => r.id === id);
  if (!rule) return;

  // ã‚¿ã‚¤ãƒˆãƒ«ãªã©è¡¨ç¤º
  document.getElementById("t").textContent = rule.title;
  document.getElementById("c").textContent = rule.category;
  document.getElementById("d").textContent = rule.description;
  document.getElementById("x").textContent = rule.detail || "";

  // ==============================
  // âœ… ãŠæ°—ã«å…¥ã‚Šç™»éŒ²ãƒ»è§£é™¤å‡¦ç†
  // ==============================
  const favBtn = document.getElementById("favoriteButton");

  // ç™»éŒ²çŠ¶æ…‹ã‚’ç¢ºèª
  let favorites = JSON.parse(localStorage.getItem("favorites") || "[]");
  let isFav = favorites.some(f => f.id === rule.id);
  favBtn.textContent = isFav ? "âœ… ç™»éŒ²æ¸ˆã¿ï¼ˆè§£é™¤ã™ã‚‹ï¼‰" : "â­ ãŠæ°—ã«å…¥ã‚Šç™»éŒ²";

  // ãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯ã§åˆ‡ã‚Šæ›¿ãˆ
  favBtn.addEventListener("click", () => {
    favorites = JSON.parse(localStorage.getItem("favorites") || "[]");
    const exists = favorites.find(f => f.id === rule.id);

    if (exists) {
      // è§£é™¤
      favorites = favorites.filter(f => f.id !== rule.id);
      localStorage.setItem("favorites", JSON.stringify(favorites));
      favBtn.textContent = "â­ ãŠæ°—ã«å…¥ã‚Šç™»éŒ²";
      alert("ãŠæ°—ã«å…¥ã‚Šã‚’è§£é™¤ã—ã¾ã—ãŸã€‚");
    } else {
      // ç™»éŒ²
      favorites.push({ id: rule.id, title: rule.title });
      localStorage.setItem("favorites", JSON.stringify(favorites));
      favBtn.textContent = "âœ… ç™»éŒ²æ¸ˆã¿ï¼ˆè§£é™¤ã™ã‚‹ï¼‰";
      alert("ãŠæ°—ã«å…¥ã‚Šã«ç™»éŒ²ã—ã¾ã—ãŸï¼");
    }
  });
});
</script>
    </div>

    <div class="btns">
      <a href="javascript:history.back()" class="btn">â¬… ä¸€è¦§ã«æˆ»ã‚‹</a>
      <a href="index.html" class="btn">ğŸ  ãƒˆãƒƒãƒ—ã¸</a>
    </div>
  </div>

  <script>
    async function main(){
      const q = new URLSearchParams(location.search);
      const id = Number(q.get("id"));
      const res = await fetch("rules.json");
      const data = await res.json();
      const r = data.find(v=>v.id===id);
      if(!r){ document.getElementById("t").textContent="ãƒ«ãƒ¼ãƒ«ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“"; return; }
      document.getElementById("t").textContent = r.title;
      document.getElementById("c").textContent = `ã‚«ãƒ†ã‚´ãƒªï¼š${r.category}`;
      document.getElementById("d").textContent = r.description;
      document.getElementById("x").textContent = r.detail;
    }
    main();
    // âœ… ãŠæ°—ã«å…¥ã‚Šç™»éŒ²ãƒ»è§£é™¤ãƒœã‚¿ãƒ³åˆ¶å¾¡
const favBtn = document.querySelector(".fav-btn"); // ç™»éŒ²ãƒœã‚¿ãƒ³
if (favBtn) {
  const id = Number(new URLSearchParams(location.search).get("id"));
  let favorites = JSON.parse(localStorage.getItem("favorites") || "[]");

  // ç¾åœ¨ã®ãƒ«ãƒ¼ãƒ«ãŒç™»éŒ²æ¸ˆã¿ã‹ã©ã†ã‹ã‚’ãƒã‚§ãƒƒã‚¯
  const isFav = favorites.some(f => Number(f.id) === id);
  favBtn.textContent = isFav ? "âœ… ç™»éŒ²æ¸ˆã¿ï¼ˆè§£é™¤ã™ã‚‹ï¼‰" : "â­ ãŠæ°—ã«å…¥ã‚Šç™»éŒ²";

  // ãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯æ™‚ã®å‡¦ç†
  favBtn.addEventListener("click", () => {
    favorites = JSON.parse(localStorage.getItem("favorites") || "[]");
    const exists = favorites.find(f => Number(f.id) === id);

    if (exists) {
      // ç™»éŒ²è§£é™¤
      favorites = favorites.filter(f => Number(f.id) !== id);
      localStorage.setItem("favorites", JSON.stringify(favorites));
      favBtn.textContent = "â­ ãŠæ°—ã«å…¥ã‚Šç™»éŒ²";
      alert("ãŠæ°—ã«å…¥ã‚Šã‚’è§£é™¤ã—ã¾ã—ãŸã€‚");
    } else {
      // ç™»éŒ²è¿½åŠ 
      favorites.push({ id, title: document.getElementById("t").textContent });
      localStorage.setItem("favorites", JSON.stringify(favorites));
      favBtn.textContent = "âœ… ç™»éŒ²æ¸ˆã¿ï¼ˆè§£é™¤ã™ã‚‹ï¼‰";
      alert("ãŠæ°—ã«å…¥ã‚Šã«ç™»éŒ²ã—ã¾ã—ãŸï¼");
    }
  });
}
  </script>
</body>
</html>
