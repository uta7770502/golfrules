<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>3タップルールズ</title>
  <link rel="stylesheet" href="style.css" />
  <style>
    body{background:#f9fff9;font-family:"Helvetica",sans-serif;margin:0;padding-bottom:90px}
    header{background:#00bfa5;color:#fff;text-align:center;padding:16px 0;font-size:24px;font-weight:bold;border-bottom-left-radius:25px;border-bottom-right-radius:25px}
    .card{background:#fff;border:1px solid #e6e6e6;border-radius:20px;margin:18px 16px;padding:18px 16px;box-shadow:0 4px 10px rgba(0,0,0,.06)}
    .title{font-size:26px;font-weight:800;color:#0f8a62;margin:12px 16px 0}
    .desc{font-size:18px;line-height:1.7;color:#222;margin:6px 0 0}
    .meta{color:#666;font-size:14px;margin:0 0 6px}
    .btn-main{display:block;width:82%;max-width:520px;margin:18px auto;background:#FFD84D;color:#00997f;font-weight:800;text-align:center;border-radius:40px;padding:14px 16px;border:none;box-shadow:0 6px 14px rgba(0,0,0,.12);text-decoration:none}
    .btn-main:active{transform:translateY(1px)}
    .bottom-nav{position:fixed;left:0;bottom:0;width:100%;height:70px;background:#fff;border-top:1px solid #ddd;display:flex;justify-content:space-around;align-items:center;box-shadow:0 -2px 8px rgba(0,0,0,.05);z-index:1000}
    .bottom-nav a{display:flex;align-items:center;justify-content:center;text-decoration:none;height:100%;width:33.33%}
    .bottom-nav img{width:50px;height:auto;display:block}
  </style>
</head>
<body>
  <header>3タップルールズ</header>

  <h1 id="ruleTitle" class="title"></h1>

  <section class="card">
    <div id="ruleMeta" class="meta"></div>
    <p id="ruleDesc" class="desc"></p>
  </section>

  <a id="goDetail" class="btn-main" href="#">ペナルティと処置方法 →</a>

  <nav class="bottom-nav">
    <a href="index.html"><img src="home-icon.png" alt="ホーム"></a>
    <a href="rules.html"><img src="book-icon.png" alt="ルール一覧"></a>
    <a href="favorites.html"><img src="star-icon.png" alt="お気に入り"></a>
  </nav>

  <script>
(async () => {
  const params = new URLSearchParams(location.search);
  const id = params.get("id");
  const titleEl = document.getElementById("ruleTitle");
  const descEl  = document.getElementById("ruleDesc");
  const metaEl  = document.getElementById("ruleMeta");
  const btn     = document.getElementById("goDetail");

  try {
    // ✅ fetch前に確実な絶対パスを組み立てる
    const basePath = window.location.origin + window.location.pathname.replace(/\/[^/]*$/, "/");
    const urls = [
      basePath + "rules_v2.json?v=" + Date.now(),
      basePath + "rules.json?v=" + Date.now()
    ];

    let rules = null;
    for (const u of urls) {
      const res = await fetch(u, { headers: { "Accept": "application/json" } });
      if (res.ok) {
        rules = await res.json();
        break;
      }
    }
    if (!rules) throw new Error("no rules");

    // ✅ IDで検索
    const rule = rules.find(r => String(r.id) === String(id));
    if (!rule) throw new Error("not found");

    titleEl.textContent = rule.title || "ルール";
    descEl.textContent  = rule.description || rule.detail || "説明がありません";
    metaEl.textContent  = rule.category ? `カテゴリ：${rule.category}` : "";

    // ✅ ボタンリンク設定
    btn.href = `rule_detail.html?id=${encodeURIComponent(rule.id)}`;

  } catch (e) {
    titleEl.textContent = "ルールの読み込みに失敗しました";
    descEl.textContent  = "";
    btn.style.display = "none";
    console.error("読み込みエラー:", e);
  }
})();
</script>
</body>
</html>
</html>
